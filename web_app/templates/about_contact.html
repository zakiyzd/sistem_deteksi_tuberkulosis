<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tentang & Kontak - Deteksi TB</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/timeline.css') }}">
</head>
<body>

    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="{{ url_for('home') }}">
                <i class="fa-solid fa-lungs-virus"></i> Deteksi TB
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('home') }}">Beranda</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('deteksi') }}">Deteksi</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#">Tentang & Kontak</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="ask-ai-popover" title="AI Assistant">Tanya AI</a>
                    </li>
                    {% if current_user.is_authenticated %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('logout') }}">Logout ({{ current_user.username }})</a>
                    </li>
                    {% else %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('login') }}">Login</a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-5">
        <div class="row">
            <!-- Timeline Section (Left) -->
            <div class="col-md-6">
                <h2 class="mb-4">Tentang Kami & Sejarah TB</h2>
                <p class="text-muted mb-4">Sebuah aplikasi web yang dirancang untuk membantu para analis klinis dalam mendeteksi potensi penyakit tuberkulosis secara cepat melalui analisis citra X-ray paru-paru menggunakan model kecerdasan buatan (AI).</p>
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <h5>Penemuan Tuberkulosis</h5>
                            <p>Pada 24 Maret 1882, Dr. Robert Koch secara resmi mengumumkan penemuan bakteri penyebab tuberkulosis (TB), yaitu Mycobacterium tuberculosis. Penemuan ini terjadi setelah Koch berhasil mengisolasi, mengkultur, dan mewarnai bakteri tersebut menggunakan teknik pewarnaan khusus. Penemuan ini menjadi tonggak penting dalam sejarah pengobatan TB, dan tanggal pengumumannya kini diperingati sebagai Hari TB Sedunia.</p>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <h5>Vaksin BCG</h5>
                            <p>Vaksin BCG (Bacillus Calmette–Guérin) adalah vaksin yang dikembangkan oleh Albert Calmette dan Camille Guérin untuk mencegah tuberkulosis (TBC), dan pertama kali digunakan pada manusia pada tahun 1921; vaksin ini masih digunakan hingga kini karena efektif melindungi terutama bayi dan anak dari bentuk TBC berat seperti TBC meningitis dan TBC milier.</p>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <h5>Pengembang Aplikasi</h5>
                            <div class="d-flex align-items-center">
                                <img src="https://placehold.co/50x50/EFEFEF/AAAAAA&text=Foto" class="rounded-circle me-3" alt="Zaki Yazid Musyaffa">
                                <div>
                                    <strong>zaki yazid musyaffa</strong><br>
                                    <small>software engineer</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contact Form Section (Right) -->
            <div class="col-md-6">
                <h2 class="mb-4">Hubungi Kami</h2>
                <form id="contactForm">
                    <div class="mb-3">
                        <label for="name" class="form-label">Nama</label>
                        <input type="text" class="form-control contact-form-input" id="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control contact-form-input" id="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="message" class="form-label">Pesan</label>
                        <textarea class="form-control contact-form-input" id="message" rows="4" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Kirim</button>
                </form>
                <div class="mt-4">
                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3966.521260322223!2d106.8195938147689!3d-6.19442039551466!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e69f5d2e764b12d%3A0x3d2c58de52f1de46!2sMonumen%20Nasional!5e0!3m2!1sen!2sid!4v1633012835365!5m2!1sen!2sid" width="100%" height="250" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-light text-center py-4 mt-5">
        <a href="#" class="text-primary me-3"><i class="fab fa-instagram fa-2x"></i></a>
        <a href="#" class="text-primary me-3"><i class="fab fa-github fa-2x"></i></a>
        <a href="#" class="text-primary me-3"><i class="fas fa-envelope fa-2x"></i></a>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/timeline.js') }}"></script>

    <!-- Popover Content -->
    <div id="popover-content" class="d-none">
        <div id="chat-messages-popover">
            <div class="bot-message">Halo! Ada yang bisa saya bantu?</div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="chat-input-popover" class="form-control" placeholder="Ketik pesan...">
            <button id="chat-send-popover"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <script>
        // Popover Chat functionality
        document.addEventListener('DOMContentLoaded', function () {
            const popoverTriggerEl = document.getElementById('ask-ai-popover');
            if (popoverTriggerEl) {
                const popover = new bootstrap.Popover(popoverTriggerEl, {
                    html: true,
                    placement: 'bottom',
                    sanitize: false, // We are providing trusted content
                    customClass: 'chat-popover', // Custom class for styling
                    content: function () {
                        return document.getElementById('popover-content').innerHTML;
                    }
                });

                const handleOutsideClick = (event) => {
                    // Close popover if click is outside of the popover and not on the trigger element
                    if (!popoverTriggerEl.contains(event.target) && !document.querySelector('.popover')?.contains(event.target)) {
                        popover.hide();
                    }
                };

                popoverTriggerEl.addEventListener('shown.bs.popover', function () {
                    // Add listener for outside clicks
                    document.addEventListener('click', handleOutsideClick);

                    const chatInputPopover = document.querySelector('.popover-body #chat-input-popover');
                    const chatSendPopover = document.querySelector('.popover-body #chat-send-popover');
                    const chatMessagesPopover = document.querySelector('.popover-body #chat-messages-popover');

                    const sendMessagePopover = () => {
                        if (!chatInputPopover || !chatMessagesPopover) return;
                        const messageText = chatInputPopover.value.trim();
                        if (messageText === '') return;

                        const userMessageElem = document.createElement('div');
                        userMessageElem.className = 'chat-message user-message';
                        userMessageElem.textContent = messageText;
                        chatMessagesPopover.appendChild(userMessageElem);
                        
                        chatInputPopover.value = '';
                        chatMessagesPopover.scrollTop = chatMessagesPopover.scrollHeight;

                        fetch('/api/chat', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ message: messageText }),
                        })
                        .then(response => response.json())
                        .then(data => {
                            const botMessageElem = document.createElement('div');
                            botMessageElem.className = 'chat-message bot-message';
                            botMessageElem.innerHTML = marked.parse(data.response || "Maaf, terjadi kesalahan.");
                            chatMessagesPopover.appendChild(botMessageElem);
                            chatMessagesPopover.scrollTop = chatMessagesPopover.scrollHeight;
                        })
                        .catch((error) => {
                            console.error('Error:', error);
                        });
                    };

                    if (chatSendPopover) {
                        chatSendPopover.onclick = sendMessagePopover;
                    }
                    if (chatInputPopover) {
                        chatInputPopover.onkeypress = (e) => {
                            if (e.key === 'Enter') {
                                sendMessagePopover();
                            }
                        };
                    }
                });

                popoverTriggerEl.addEventListener('hidden.bs.popover', function () {
                    // Remove listener when popover is hidden
                    document.removeEventListener('click', handleOutsideClick);
                });
            }

            // Ensure chat message styles are present
            if (!document.getElementById('chat-styles')) {
                const style = document.createElement('style');
                style.id = 'chat-styles';
                style.innerHTML = `
                    .chat-popover {
                        width: 360px; 
                        border-radius: 0.75rem;
                        border: none;
                        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
                    }
                    .popover-header {
                        background-color: #f8f9fa;
                        border-bottom: 1px solid #dee2e6;
                        font-weight: 600;
                        font-size: 1rem;
                    }
                    .popover-body { 
                        padding: 0; 
                    }
                    #chat-messages-popover {
                        height: 300px; 
                        overflow-y: auto; 
                        display: flex; 
                        flex-direction: column; 
                        gap: 12px; 
                        padding: 16px;
                    }
                    #chat-messages-popover::-webkit-scrollbar { width: 6px; }
                    #chat-messages-popover::-webkit-scrollbar-track { background: #f1f1f1; }
                    #chat-messages-popover::-webkit-scrollbar-thumb { background: #888; border-radius: 3px; }
                    #chat-messages-popover::-webkit-scrollbar-thumb:hover { background: #555; }
                    .chat-message { 
                        padding: 10px 15px; 
                        border-radius: 20px; 
                        max-width: 85%; 
                        word-wrap: break-word;
                    }
                    .user-message { 
                        background-image: linear-gradient(to right, #0d6efd, #0a58ca);
                        color: white; 
                        align-self: flex-end; 
                        border-bottom-right-radius: 5px;
                    }
                    .bot-message { 
                        background-color: #e9ecef; 
                        color: #343a40; 
                        align-self: flex-start; 
                        border-bottom-left-radius: 5px;
                    }
                    .chat-input-area {
                        display: flex;
                        align-items: center;
                        padding: 10px;
                        border-top: 1px solid #dee2e6;
                    }
                    #chat-input-popover {
                        border: none;
                        background-color: transparent;
                        flex-grow: 1;
                        padding: 8px;
                    }
                    #chat-input-popover:focus {
                        outline: none;
                        box-shadow: none;
                    }
                    #chat-send-popover {
                        background: none;
                        border: none;
                        color: #007bff;
                        font-size: 1.2rem;
                        padding: 5px 10px;
                        transition: color 0.2s;
                    }
                    #chat-send-popover:hover {
                        color: #0056b3;
                    }
                `;
                document.head.appendChild(style);
            }
        });
    </script>
</body>
</html>
